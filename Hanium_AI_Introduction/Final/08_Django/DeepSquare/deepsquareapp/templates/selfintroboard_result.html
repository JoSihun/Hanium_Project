{% extends "base.html" %}
{% block content %}

        <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

     <div class="masthead ">
     <div class="container">
         <div class="row">
             <div class="col-md-12 col-xs-12 col-lg-12 col-sm-12 mx-auto">
                 <div class="text-center">
                     <h1>자기소개서 분석 결과</h1>
                 </div>
                 <br><br><br>
                 <table class="table">
                     <thead style="white-space:nowrap;">
                     <tr>
                         <th scope="col">번호 : {{post.id}}</th>
                         <th>작성일 : {{post.registered_date}}</th>
                     </tr>
                     </thead>
                     <tbody>
                     <tr>
                         <th scope="row" style="white-space:nowrap;">제목</th>
                         <td>{{post.title}}</td>
                     </tr>
                     <tr>
                         <th scope="row" style="white-space:nowrap;">기업</th>
                         <td>{{post.company_name}}</td>
                     </tr>
                     <tr>
                         <th scope="row" style="white-space:nowrap;">직무</th>
                         <td>{{post.department_name}}</td>
                     </tr>

                     <tr>
                         <th scope="row" style="white-space:nowrap;">내용</th>
                         <!--td>{{post.contents}}</td-->
                         <td>
                             {% for result in grammar_result.result_list %}
                                {% if result.0 == result.1 %}
                                    <span style="color:black">{{ result.0 | linebreaksbr }}</span>
                                {% else %}
                                    <span style="color:red">{{ result.0 | linebreaksbr }}</span>
                                {% endif %}
                             {% endfor %}
                         </td>
                     </tr>
                     <tr>
                         <th scope="row" style="white-space:nowrap;">맞춤법 검사</th>
                         <<!--td>{{grammar_check}}</td-->
                         <td>
                             {% for result in grammar_result.result_list %}
                                {% if result.0 == result.1 %}
                                    <span style="color:black">{{ result.1 | linebreaksbr }}</span>
                                {% else %}
                                    <span style="color:blue">{{ result.1 | linebreaksbr }}</span>
                                {% endif %}
                             {% endfor %}
                         </td>
                     </tr>
                     </tbody>
                 </table>
             <br><br>


                 <div class="row my-2">
                     <div class="col-5 mx-auto">
                         <canvas id="myChart"></canvas><br>
                         <div class="text-center text-dark">
                             <h5>표절률 {{ plagiarism_percent }}(%)</h5>
                         </div>
                     </div>
                     <div class="col-5 mx-auto">
                         <canvas id="myChart1"></canvas><br>
                         <div class=" text-center text-dark">
                             <h5>적합률 {{ keyword_percent }}(%)</h5>
                         </div>
                     </div>
                 </div>
                 <br>

               <div class="row">
                     <div class="col-10 mx-auto">
                         <canvas id="radarChart1"></canvas><br>
                         <div class="text-center text-dark">
                             <h5>사용자 직무 역량</h5>
                         </div>
                     </div>
                 </div>
                 <div class="row">
                     <div class="col-12 mx-auto">
                         <div class="card">
                             <div class="card-body">
                                 <h>{{ user_competency_comment | linebreaksbr }}</h>
                            </div>
                         </div>
                     </div>
                 </div>
                 <br><br>

                 <div class="row">
                     <div class="col-10 mx-auto">
                         <canvas id="radarChart2"></canvas><br>
                         <div class="text-center text-dark">
                             <h5>직무 평균 역량</h5>
                         </div>
                     </div>
                 </div>
                 <div class="row">
                     <div class="col-12 mx-auto">
                         <div class="card">
                             <div class="card-body">
                                 <h>{{ average_competency_comment | linebreaksbr }}</h>
                            </div>
                         </div>
                     </div>
                 </div>
                 <br><br>

                 <div class="row">
                     <div class="col-12 mx-auto">
                         <div class="card">
                             <div class="card-header text-center">
                                 <h5>첨삭 결과</h5>
                             </div>
                             <div class="card-body">
                                 <h>여기에 첨삭 결과가 보여짐</h>
                            </div>
                         </div>
                     </div>
                 </div>
                 <br><br>
                     <div class="text-center">
                     <button type = "button" class = "btn btn-xl btn-outline-dark" onclick = "location.href = '/'"><i class="fas fa-home"></i>&nbsp;&nbsp;HOME</button>
                 </div>
             </div>
         </div>
     </div>
 </div>




    <script>
        Chart.pluginService.register({
      beforeDraw: function(chart) {
        if (chart.config.options.elements.center) {
          // Get ctx from string
          var ctx = chart.chart.ctx;

          // Get options from the center object in options
          var centerConfig = chart.config.options.elements.center;
          var fontStyle = centerConfig.fontStyle || 'Arial';
          var txt = centerConfig.text;
          var color = centerConfig.color || '#000';
          var maxFontSize = centerConfig.maxFontSize || 75;
          var sidePadding = centerConfig.sidePadding || 20;
          var sidePaddingCalculated = (sidePadding / 100) * (chart.innerRadius * 2)
          // Start with a base font of 30px
          ctx.font = "30px " + fontStyle;

          // Get the width of the string and also the width of the element minus 10 to give it 5px side padding
          var stringWidth = ctx.measureText(txt).width;
          var elementWidth = (chart.innerRadius * 2) - sidePaddingCalculated;

          // Find out how much the font can grow in width.
          var widthRatio = elementWidth / stringWidth;
          var newFontSize = Math.floor(30 * widthRatio);
          var elementHeight = (chart.innerRadius * 2);

          // Pick a new font size so it will not be larger than the height of label.
          var fontSizeToUse = Math.min(newFontSize, elementHeight, maxFontSize);
          var minFontSize = centerConfig.minFontSize;
          var lineHeight = centerConfig.lineHeight || 25;
          var wrapText = false;

          if (minFontSize === undefined) {
            minFontSize = 20;
          }

          if (minFontSize && fontSizeToUse < minFontSize) {
            fontSizeToUse = minFontSize;
            wrapText = true;
          }

          // Set font settings to draw it correctly.
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          var centerX = ((chart.chartArea.left + chart.chartArea.right) / 2);
          var centerY = ((chart.chartArea.top + chart.chartArea.bottom) / 2);
          ctx.font = fontSizeToUse + "px " + fontStyle;
          ctx.fillStyle = color;

          if (!wrapText) {
            ctx.fillText(txt, centerX, centerY);
            return;
          }

          var words = txt.split(' ');
          var line = '';
          var lines = [];

          // Break words up into multiple lines if necessary
          for (var n = 0; n < words.length; n++) {
            var testLine = line + words[n] + ' ';
            var metrics = ctx.measureText(testLine);
            var testWidth = metrics.width;
            if (testWidth > elementWidth && n > 0) {
              lines.push(line);
              line = words[n] + ' ';
            } else {
              line = testLine;
            }
          }

          // Move the center up depending on line height and number of lines
          centerY -= (lines.length / 2) * lineHeight;

          for (var n = 0; n < lines.length; n++) {
            ctx.fillText(lines[n], centerX, centerY);
            centerY += lineHeight;
          }
          //Draw text in center
          ctx.fillText(line, centerX, centerY);
        }
      }
    });


var config = {
  type: 'doughnut',
  data: {
    labels: [
      "표절률 (%)",
      "비표절률 (%)",
    ],
    datasets: [{
      data: [{{ plagiarism_percent }}, {{ non_plagiarism_percent }}],
      backgroundColor: [
        "#F00000",
        "#36A2EB"
      ],
      hoverBackgroundColor: [
        "#F00000",
        "#36A2EB"
      ]
    }]
  },
  options: {
    elements: {
      center: {
        text: '표절률%',
        color: '#F00000', // Default is #000000
        fontStyle: 'Arial', // Default is Arial
        sidePadding: 20, // Default is 20 (as a percentage)
        minFontSize: 10, // Default is 20 (in px), set to false and text will not wrap.
        lineHeight: 25 // Default is 25 (in px), used for when text wraps
      }
    }
  }
};

var keyword_percent = {{ keyword_percent }};

var config1 = {
  type: 'doughnut',
  data: {
    labels: [
      "적합률 (%)",
      "비적합률 (%)",
    ],
    datasets: [{
      data: [{{ keyword_percent }}, 100-keyword_percent],
      backgroundColor: [
        "#2ad12a",
        "#F00000"
      ],
      hoverBackgroundColor: [
        "#2ad12a",
        "#F00000"
      ]
    }]
  },
  options: {
    elements: {
      center: {
        text: '적합률%',
        color: '#0000F0', // Default is #000000
        fontStyle: 'Arial', // Default is Arial
        sidePadding: 20, // Default is 20 (as a percentage)
        minFontSize: 10, // Default is 20 (in px), set to false and text will not wrap.
        lineHeight: 25 // Default is 25 (in px), used for when text wraps
      }
    }
  }
};
var ctx = document.getElementById("myChart").getContext("2d");
var myChart = new Chart(ctx, config);
var ctx = document.getElementById("myChart1").getContext("2d");
var myChart1 = new Chart(ctx, config1);
    </script>

    <script>
    //radar
//Top10 사용자 역량 이름 저장
var user_competency_top10_name = new Array(10);
for(var i=0; i<user_competency_top10_name.length;i++){
    user_competency_top10_name[i] = {{ user_competency_top10_name|safe }}[i];
}
//Top10 직무 평균 역량 이름 저장
var average_competency_top10_name = new Array(10);
for(var i=0; i<user_competency_top10_name.length;i++){
    average_competency_top10_name[i] = {{ average_competency_top10_name|safe }}[i];
}

var ctxR = document.getElementById("radarChart1").getContext('2d');
var myRadarChart = new Chart(ctxR, {
type: 'radar',
data: {
labels: [user_competency_top10_name[0], user_competency_top10_name[1], user_competency_top10_name[2],
        user_competency_top10_name[3], user_competency_top10_name[4], user_competency_top10_name[5],
        user_competency_top10_name[6], user_competency_top10_name[7], user_competency_top10_name[8],
        user_competency_top10_name[9]], // Top 10 역량
datasets: [{
label: "사용자 직무 역량",
data: [{{user_competency_top10_count}}[0], {{user_competency_top10_count}}[1], {{user_competency_top10_count}}[2],
        {{user_competency_top10_count}}[3], {{user_competency_top10_count}}[4], {{user_competency_top10_count}}[5],
        {{user_competency_top10_count}}[6], {{user_competency_top10_count}}[7], {{user_competency_top10_count}}[8],
        {{user_competency_top10_count}}[9]],
backgroundColor: [
'rgba(105, 0, 132, .2)',
],
borderColor: [
'rgba(200, 99, 132, .7)',
],
borderWidth: 2
},
{
label: "해당 직무 역량",
data: [{{user_and_average_competency}}[0], {{user_and_average_competency}}[1], {{user_and_average_competency}}[2],
        {{user_and_average_competency}}[3], {{user_and_average_competency}}[4], {{user_and_average_competency}}[5],
        {{user_and_average_competency}}[6], {{user_and_average_competency}}[7], {{user_and_average_competency}}[8],
        {{user_and_average_competency}}[9]],
backgroundColor: [
'rgba(0, 250, 220, .2)',
],
borderColor: [
'rgba(0, 213, 132, .7)',
],
borderWidth: 2
}
]
},
options: {
responsive: true
}
});
    </script>

        <script>
    //radar
var ctxR = document.getElementById("radarChart2").getContext('2d');
var myRadarChart = new Chart(ctxR, {
type: 'radar',
data: {
labels: [average_competency_top10_name[0], average_competency_top10_name[1], average_competency_top10_name[2],
        average_competency_top10_name[3], average_competency_top10_name[4], average_competency_top10_name[5],
        average_competency_top10_name[6], average_competency_top10_name[7], average_competency_top10_name[8],
        average_competency_top10_name[9]], // Top 10 역량
datasets: [{
label: "직무 평균 역량",
data: [{{average_competency_top10_count}}[0], {{average_competency_top10_count}}[1], {{average_competency_top10_count}}[2],
        {{average_competency_top10_count}}[3], {{average_competency_top10_count}}[4], {{user_competency_top10_count}}[5],
        {{average_competency_top10_count}}[6], {{user_competency_top10_count}}[7], {{user_competency_top10_count}}[8],
        {{average_competency_top10_count}}[9]],
backgroundColor: [
'rgba(0, 250, 220, .2)',
],
borderColor: [
'rgba(0, 213, 132, .7)',
],
borderWidth: 2
}
]
},
options: {
responsive: true
}
});
    </script>

    <script>
    new Chart(document.getElementById("horizontalBar1"), {
"type": "horizontalBar",
"data": {
"labels": ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10"],
"datasets": [{
"label": "사용자 직무 역량",
"data": [65, 59, 90, 81, 56, 55, 40, 23, 60, 70],
"fill": false,
"backgroundColor": ["rgba(255, 99, 132, 0.2)", "rgba(255, 159, 64, 0.2)",
"rgba(255, 205, 86, 0.2)", "rgba(75, 192, 192, 0.2)", "rgba(54, 162, 235, 0.2)",
"rgba(153, 102, 255, 0.2)", "rgba(201, 203, 207, 0.2)"
],
"borderColor": ["rgb(255, 99, 132)", "rgb(255, 159, 64)", "rgb(255, 205, 86)",
"rgb(75, 192, 192)", "rgb(54, 162, 235)", "rgb(153, 102, 255)", "rgb(201, 203, 207)"
],
"borderWidth": 1
}]
},
"options": {
"scales": {
"xAxes": [{
"ticks": {
"beginAtZero": true
}
}]
}
}
});
    </script>

        <script>
    new Chart(document.getElementById("horizontalBar2"), {
"type": "horizontalBar",
"data": {
"labels": ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10"],
"datasets": [{
"label": "기업 직무 역량",
"data": [28, 48, 40, 19, 54, 27, 69, 15, 82, 45],
"fill": false,
"backgroundColor": ["rgba(255, 99, 132, 0.2)", "rgba(255, 159, 64, 0.2)",
"rgba(255, 205, 86, 0.2)", "rgba(75, 192, 192, 0.2)", "rgba(54, 162, 235, 0.2)",
"rgba(153, 102, 255, 0.2)", "rgba(201, 203, 207, 0.2)"
],
"borderColor": ["rgb(255, 99, 132)", "rgb(255, 159, 64)", "rgb(255, 205, 86)",
"rgb(75, 192, 192)", "rgb(54, 162, 235)", "rgb(153, 102, 255)", "rgb(201, 203, 207)"
],
"borderWidth": 1
}]
},
"options": {
"scales": {
"xAxes": [{
"ticks": {
"beginAtZero": true
}
}]
}
}
});
    </script>
{% endblock content %}